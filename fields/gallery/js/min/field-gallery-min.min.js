!function($){function e(e){var t=new XMLHttpRequest;return t.open("HEAD",e,!1),t.send(),404!=t.status}String.prototype.splice=function(e,t,a){return this.slice(0,e)+a+this.slice(e+Math.abs(t))},protonFieldMethods.gallery={_init:function(e){var t=e.find(".proton-gallery-values").val();if(""!==t){var a=t.split(","),l=e.find(".proton-container-gallery");l.html(""),a.forEach(function(e){l.append('<li class="proton-field-gallery-image" id="pim_'+e+'"><i class="livicon shadowed" data-s="32" data-n="spinner-seven" data-loop="true" data-c="#fff" data-hc="#fff" style="width: 32px; height: 32px;"></i></li>');var t={action:"proton_ajax_attachment_url",security:proton_var.proton_nonce,pimid:e,pimsize:"thumbnail"};$.post(ajaxurl,t,function(t){var a="<img src='"+t+"' alt='' /><input data-field='id' type='hidden' name='gallery_item[id][]' value='"+e+"'/>";l.find("#pim_"+e).html(a)})}),e.find(".gallery_sort").length&&e.find(".gallery_sort").sortable({update:function(t,a){var l=$(this),n=[];l.children().each(function(e,t){var a=$(t).find('input[name="gallery_item[id][]"]').val();n.push(a)}),e.find(".proton-gallery-values").val(n.join(","))},placeholder:"ui-state-highlight"})}},_destroy:function(e){}};var t={};t.init=function(e){e||(e=$(document).find(".proton-field-gallery")),$(".gallery_sort").length&&$(".gallery_sort").sortable({update:function(e,t){var a=$(this),l=[];a.children().each(function(e,t){var a=$(t).find('input[name="gallery_item[id][]"]').val();l.push(a)}),a.parent().find(".proton-gallery-values").val(l.join(","))},placeholder:"ui-state-highlight",revert:!0}),$(document).on("click",".proton-gallery-attachments",function(e){var t=$(this).closest("fieldset"),a=t.find(".proton-container-gallery").attr("data-placeholder");if($(e.currentTarget).hasClass("proton-clearimages")){var l=t.find(".proton-gallery-values").val("");return void t.find(".proton-container-gallery").html('<li class="proton-gallery-placeholder proton-gallery-attachments"><h4>'+a+"</h4></li>")}if("undefined"!=typeof wp&&wp.media&&wp.media.gallery){e.preventDefault();var n=t.find(".proton-gallery-values").val(),i;i=n?'[gallery ids="'+n+'"]':'[gallery ids="0"]';var r=wp.media({frame:"select",multiple:!0});return r.on("open",function(){var e=r.state().get("selection"),t=n.split(",");t.forEach(function(t){var a=wp.media.attachment(t);a.fetch(),e.add(a?[a]:[])})}),r.on("close",function(){t.find(".proton-container-gallery").html("");var e,l="",n,i=r.state().get("selection"),o=i.models.map(function(a){return e=a.toJSON(),""===e.id?!1:(n="undefined"!=typeof e.sizes.thumbnail?e.sizes.thumbnail.url:e.url,l="<li class='proton-field-gallery-image'><img src='"+n+"' alt='' /><input data-field='id' type='hidden' name='gallery_item[id][]' value='"+e.id+"'/><input data-field='img' type='hidden' name='gallery_item[img][]' value='"+n+"'/><input data-field='name' type='hidden' name='gallery_item[name][]' value='"+e.name+"'/><input data-field='title' type='hidden' name='gallery_item[title][]' value='"+e.title+"'/></li>",t.find(".proton-container-gallery").append(l),a.id)});t.find(".proton-gallery-values").val(o.join(",")),"false"===o.join(",")&&t.find(".proton-container-gallery").html('<li class="proton-gallery-placeholder proton-gallery-attachments"><h4>'+a+"</h4></li>")}).open(),!1}})},$(document).ready(function(){t.init()})}(jQuery);