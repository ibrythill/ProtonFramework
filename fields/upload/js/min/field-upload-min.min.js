!function($){protonFieldMethods.upload={_init:function(a){var e=a.find(".proton-upload-values").val(),t=a.find(".proton-container-upload"),i=t.attr("data-output"),l=t.attr("data-placeholder"),n=t.attr("data-viewfile"),d=/(^.*\.jpg|jpeg|png|gif|ico*)/gi;if(""!==e)if(t.html('<li class="proton-field-upload-image"><i class="livicon shadowed" data-s="32" data-n="spinner-seven" data-loop="true" data-c="#fff" data-hc="#fff" style="width: 32px; height: 32px;"></i></li>'),"id"===i){var o={action:"proton_ajax_attachment_url",security:proton_var.proton_nonce,pimid:e,pimsize:"thumbnail"};$.post(ajaxurl,o,function(a){if(a.match(d))var i='<li class="proton-field-upload-image" id="pim_'+e+'"><img src="'+a+'" alt="" /></li>';else var i='<li class="proton-upload-file"><a href="'+a+'" target="_blank" rel="external"><h4>'+n+"</h4></a></li>";t.html(i)})}else{if(t.html(""),e.match(d)){var o={action:"proton_ajax_attachment_url",security:proton_var.proton_nonce,pimid:e,pimsize:"thumbnail"};$.post(ajaxurl,o,function(a){var i='<li class="proton-field-upload-image" id="pim_'+e+'"><img src="'+a+'" alt="" /></li>';t.append(i)})}else var p='<li class="proton-upload-file"><a href="'+e+'" target="_blank" rel="external"><h4>'+n+"</h4></a></li>";t.html(p)}},_destroy:function(a){}};var a={};a.init=function(a){$(document).on("click",".proton-upload-attachments",function(a){var e=$(this).closest("fieldset"),t=e.find(".proton-container-upload").attr("data-placeholder"),i=e.find(".proton-container-upload").attr("data-viewfile"),l=/(^.*\.jpg|jpeg|png|gif*)/gi,n=/(^.*\.pdf|doc|docx|ppt|pptx|svg|odt*)/gi,d=/(^.*\.mp3|m4a|ogg|wav*)/gi,o=/(^.*\.mp4|m4v|mov|wmv|avi|mpg|ogv|3gp|3g2*)/gi,p=e.find(".proton-container-upload").attr("data-output");if($(a.currentTarget).hasClass("proton-clearimages")){var u=e.find(".proton-upload-values").val("");return void e.find(".proton-container-upload").html('<li class="proton-upload-placeholder proton-upload-attachments"><h4>'+t+"</h4></li>")}if("undefined"!=typeof wp&&wp.media&&wp.media.gallery){a.preventDefault();var r=e.find(".proton-upload-values").val(),m;m=r?'[gallery ids="'+r+'"]':'[gallery ids="0"]';var f=wp.media({frame:"select",multiple:!1});return f.on("open",function(){var a=f.state().get("selection"),e=r.split(",");e.forEach(function(e){var t=wp.media.attachment(e);t.fetch(),a.add(t?[t]:[])})}),f.on("close",function(){e.find(".proton-container-upload").html("");var a,n="",d,o=f.state().get("selection");if("id"===p){var u=o.models.map(function(t){return a=t.toJSON(),console.log(a),""===a.id?!1:(a.filename.match(l)?(d="undefined"!=typeof a.sizes&&"undefined"!=typeof a.sizes.thumbnail?a.sizes.thumbnail.url:a.url,n="<li class='proton-field-upload-image'><img src='"+d+"' alt='' /><input data-field='id' type='hidden' name='upload_item[id][]' value='"+a.id+"'/><input data-field='img' type='hidden' name='upload_item[img][]' value='"+a.url+"'/><input data-field='name' type='hidden' name='upload_item[name][]' value='"+a.name+"'/><input data-field='title' type='hidden' name='upload_item[title][]' value='"+a.title+"'/></li>"):n="<li class='proton-upload-file'><a href='"+a.url+"' target='_blank' rel='external'><h4>"+i+"</h4></a><input data-field='id' type='hidden' name='upload_item[id][]' value='"+a.id+"'/><input data-field='img' type='hidden' name='upload_item[img][]' value='"+a.url+"'/><input data-field='name' type='hidden' name='upload_item[name][]' value='"+a.name+"'/><input data-field='title' type='hidden' name='upload_item[title][]' value='"+a.title+"'/></li>",e.find(".proton-container-upload").append(n),t.id)});e.find(".proton-upload-values").val(u.join(","))}else{var a=f.state().get("selection").first().toJSON(),u=a.url;d="undefined"!=typeof a.sizes?a.sizes.thumbnail.url:a.url,n=d.match(l)?"<li class='proton-field-upload-image'><img src='"+d+"' alt='' /><input data-field='id' type='hidden' name='upload_item[id][]' value='"+a.id+"'/><input data-field='img' type='hidden' name='upload_item[img][]' value='"+a.url+"'/><input data-field='name' type='hidden' name='upload_item[name][]' value='"+a.name+"'/><input data-field='title' type='hidden' name='upload_item[title][]' value='"+a.title+"'/></li>":"<li class='proton-upload-file'><a href='"+a.url+"' target='_blank' rel='external'><h4>"+i+"</h4></a><input data-field='id' type='hidden' name='upload_item[id][]' value='"+a.id+"'/><input data-field='img' type='hidden' name='upload_item[img][]' value='"+a.url+"'/><input data-field='name' type='hidden' name='upload_item[name][]' value='"+a.name+"'/><input data-field='title' type='hidden' name='upload_item[title][]' value='"+a.title+"'/></li>",e.find(".proton-container-upload").append(n),e.find(".proton-upload-values").val(u)}""===u&&e.find(".proton-container-upload").html('<li class="proton-upload-placeholder proton-upload-attachments"><h4>'+t+"</h4></li>")}).open(),!1}})},$(document).ready(function(){a.init()})}(jQuery);